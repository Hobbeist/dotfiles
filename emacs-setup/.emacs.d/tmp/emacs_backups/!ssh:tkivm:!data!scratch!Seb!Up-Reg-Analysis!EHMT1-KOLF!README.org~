#+TITLE:Upstream Regulatory Analysis: EHMT1 KOLF 
#+AUTHOR: Sebastian Rauschert, PhD
#+email: Sebastian.Rauschert@telethonkids.org.au
#+INFOJS_OPT: 
#+BABEL: :session *R* :cache yes :results output graphics :exports both :tangle yes 
-----
* Overview of this project folder
#+begin_src sh :results output :exports results
  echo "Directory structure:"
  tree -d .
#+end_src

#+RESULTS:
: Directory structure:
: .
: ├── applications
: ├── code
: ├── data
: ├── outputs
: └── singularity
: 
: 5 directories

* Extract bases: fasta generation

#+BEGIN_SRC R :tangle code/create-bed-script
  library(tidyverse)

  # Read the data with all KOLF results
  kolf <- read_csv("../data/DE-results/KOLF.csv")

  # Create the script for the significant genes
  kolf %>%
    filter(padj <=0.05) %>%
    select(Gene) %>%
    unlist() %>%
    as.character() %>%
    paste(.,collapse="|") %>%
    paste0("cat data/gtf/gencode.v29.annotation.gtf | grep -E '", .,"' > data/gtf/results_kolf.txt") %>%
    cat(., file='code/extract-location.sh')

  

  # Create the script for the background genes
  kolf %>% 
    select(log2FoldChange) %>% 
    unlist() %>% 
    as.numeric() %>% 
    abs() %>% 
    mean() -> abs_log_fold


  kolf %>%
    filter(abs(log2FoldChange) > abs_log_fold) -> all_larger_than_mean_fold_change

  kolf %>%
    filter(padj <=0.05) %>%
    select(Gene) %>%
    unlist() %>%
    as.character() -> significant_genes


  all_larger_than_mean_fold_change %>%
    filter(!Gene %in% significant_genes) -> non_sig_larger_mean

  non_sig_larger_mean %>%
    select(Gene) %>%
    unlist() %>%
    as.character() %>%
    paste(.,collapse="|") %>%
    paste0("cat data/gtf/gencode.v29.annotation.gtf | grep -E '", .,"' > data/gtf/results_background.txt") %>%
    cat(., file='code/extract-background-location.sh')

#+END_SRC

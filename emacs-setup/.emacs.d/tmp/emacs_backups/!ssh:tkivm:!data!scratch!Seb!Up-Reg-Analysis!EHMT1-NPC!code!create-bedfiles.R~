library(tidyverse)
# Load the data
dat   <- read_delim("~/Desktop/extracted_locations.txt", delim = "\t")

# Load the significant gene list
rna_dat       <- read_csv("~/Desktop/gene_id_NPC.csv")
upregulated   <- rna_dat[which(rna_dat$log2FoldChange > 0),"Gene"]
downregulated <- rna_dat[which(rna_dat$log2FoldChange < 0),"Gene"]
  
unlist(lapply(dat$Geneid, function(x) str_split(x, "\\.")[[1]][1]))

# Bedfile for upregulated genes
dat %>%
  filter(Geneid %in% unlist(upregulated)) %>%
  select(Chromosome, Start, End, Strand) %>%
  mutate(motif_start = ifelse(Strand %in% "+", (Start - 500), End)) %>%
  mutate(motif_end = ifelse(Strand %in% "+", Start, (End + 500))) %>%
  select(Chromosome, motif_start, motif_end, Strand) -> UpBed

# Bedfile for downregulated genes
dat %>%
  filter(Geneid %in% unlist(downregulated)) %>%
  select(Chromosome, Start, End, Strand) %>%
  mutate(motif_start = ifelse(Strand %in% "+", (Start - 500), End)) %>%
  mutate(motif_end = ifelse(Strand %in% "+", Start, (End + 500))) %>%
  select(Chromosome, motif_start, motif_end, Strand) -> DownBed

write_delim(UpBed, "../data/bedfiles/Upregulated_500bp.bed", delim = "\t", col_names=F)
write_delim(DownBed, "data/bedfiles/Downregulated_500bp.bed", delim = "\t", col_names=F)

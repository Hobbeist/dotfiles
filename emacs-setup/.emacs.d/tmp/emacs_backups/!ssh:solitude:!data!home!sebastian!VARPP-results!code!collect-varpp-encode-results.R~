# This script will collect all results from VARPP,
# both for the GTEx and for the HCL data.
#
# Sebastian Rauschert, PhD
# 20/01/2021
#
# NOTES:
# I decided to make it a datalad set, so I don't run
# into the usual issues about "how did we get there".

library(tidyverse)
library(varppRule)

#========================================================================
# Gtex
#========================================================================

# List all the files in the GTEx results folder
files_gtex <- list.files("/data//sebastian//varpp2//results//varpp-gtex")
path       <- "/data//sebastian//varpp2//results//varpp-gtex"

## Load the first file
gtex <- varppRule::performance_varpp(readRDS(paste0(path,"//",files_gtex[1]))) %>%
                                     mutate(HPO = str_replace(files_gtex[1], "_gtex-varpp.rds", ""))


## Load all results
for(i in 2:length(files_gtex)){


    gtex <- rbind(gtex, varppRule::performance_varpp(readRDS(paste0(path,"//",files_gtex[i]))) %>%
                                     mutate(HPO = str_replace(files_gtex[i], "_gtex-varpp.rds", "")))
    

    }

## Save the results
write_csv(gtex, "results/varpp-gtex.csv")


#========================================================================
# HCL
#========================================================================

# List all the files in the GTEx results folder
files_hcl  <- list.files("/data//sebastian//varpp2//results//varpp-hcl")
path       <- "/data//sebastian//varpp2//results//varpp-hcl"

## Load the first file
hcl <- varppRule::performance_varpp(readRDS(paste0(path,"//",files_hcl[1]))) %>%
                                     mutate(HPO = str_replace(files_hcl[1], "_hcl-varpp.rds", ""))


## Load all results
for(i in 2:length(files_hcl)){


    hcl <- rbind(hcl, varppRule::performance_varpp(readRDS(paste0(path,"//",files_hcl[i]))) %>%
                                     mutate(HPO = str_replace(files_hcl[i], "_hcl-varpp.rds", "")))
    

    }

## Save the results
write_csv(hcl, "results/varpp-hcl.csv")
